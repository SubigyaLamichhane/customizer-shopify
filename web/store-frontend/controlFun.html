<html>
<head>
<style type="text/css">
    .canvas-container{
        padding: 20px;
    }
    #pdfcanvas + .upper-canvas{
        border:1px solid #000000;
/*        z-index: 1;*/

/*        width: 550px !important;*
/*        height: 550px !important;*/
        
    }
    #pdfcanvas {
/*  position: relative !important;*/
/*        width: 450px !important;*/
/*        height: 450px !important;*/
        border:1px solid #ff0000;
/*        left:25px !important;*/
/*        top:25px !important;*/
    }
</style>
</head>

<body>

<div class="canvas-container-wrapper">
  <canvas id="pdfcanvas" width="500" height="500"></canvas>
</div>

<button id="inline-btn">Go</button>

<script src="https://code.jquery.com/jquery-3.6.3.js"></script>
 <!-- Include Fabric.js in the page -->
<script src="assets/js/fabric.min.js"></script>

</body>
</html>


<script>
var canvas = new fabric.Canvas('pdfcanvas', {
    fireRightClick: true,
    stopContextMenu: true,
    controlsAboveOverlay: true,
});
canvas.controlsAboveOverlay = true;

fabric.Canvas.prototype.getAbsoluteCoords = function(object) {
    console.log("req => ", object);
    return {
      left: object.left + this._offset.left,
      top: object.top + this._offset.top
    };
}

var btn = document.getElementById('inline-btn'),
      btnWidth = 85,
      btnHeight = 18;

  function positionBtn(obj){
    var absCoords = canvas.getAbsoluteCoords(obj);
    console.log(" absolute coards => ", absCoords);

    btn.style.left = (absCoords.left - btnWidth / 2) + 'px';
    btn.style.top = (absCoords.top - btnHeight / 2) + 'px';
  }

  fabric.Image.fromURL('assets/images/animal1.png', function(img) {

    canvas.add(img.set({ left: 250, top: 250, angle: 30 }).scale(0.25));
    img.on('moving', function() { positionBtn(img) });
    img.on('scaling', function() { positionBtn(img) });
    positionBtn(img);

    });

    // canvas.on('moving', function() { positionBtn(canvas.getActiveObject()) });
    // canvas.on('scaling', function() { positionBtn(canvas.getActiveObject()) });
    // positionBtn(canvas.getActiveObject());



var text_val = "We are best";
var textBox = new fabric.Textbox(text_val,{
            fontSize: 25,
            fontFamily: 'Arial',
            textAlign: 'center', 
            fontWeight:'normal', 
            width: 200, // for 20 characters
            editable: false,
            lockUniScaling: true,
            fixedWidth:200,
            type: 'text'
        });
textBox.setControlsVisibility({
            tl: true,
            bl: true,
            tr: true,
            br: true,
            ml: true,
            mb: true,
            mr: true,
            mt: true,
            mtr: true
        });

        canvas.add(textBox);
        canvas.setActiveObject(textBox);
        canvas.renderAll();


</script>

<!-- First option -->
<script type="text/javascript">

    var CANVAS_WIDTH = canvas.wrapperEl.lastChild.clientWidth;
    var CANVAS_HEIGHT = canvas.wrapperEl.lastChild.clientHeight;
    console.log("upper width : ", CANVAS_WIDTH, " | height : ", CANVAS_HEIGHT);

	canvas.on('object:scaling', function (e) {
      var obj = e.target;
      obj.setCoords();
      let top = obj.getBoundingRect().top;
      let left = obj.getBoundingRect().left;
      let height = obj.getBoundingRect().height;
      let width = obj.getBoundingRect().width;

      // restrict scaling below bottom of canvas
      if (top + height > CANVAS_HEIGHT) {
        obj.scaleY = 1;
        obj.setCoords();
        let h = obj.getScaledHeight();

        obj.scaleY = (CANVAS_HEIGHT - top) / h;
        obj.setCoords();
        canvas.renderAll();

        obj.lockScalingX = true;
        obj.lockScalingY = true;
        obj.lockMovementX = true;
        obj.lockMovementY = true;
      }

      // restrict scaling above top of canvas
      if (top < 0) {
        obj.scaleY = 1;
        obj.setCoords();
        let h = obj.getScaledHeight();
        obj.scaleY = (height + top) / h;
        obj.top = 0;
        obj.setCoords();
        canvas.renderAll();

        obj.lockScalingX = true;
        obj.lockScalingY = true;
        obj.lockMovementX = true;
        obj.lockMovementY = true;
      }

      // restrict scaling over right of canvas
      if (left + width > CANVAS_WIDTH) {
        obj.scaleX = 1;
        obj.setCoords();
        let w = obj.getScaledWidth();

        obj.scaleX = (CANVAS_WIDTH - left) / w;
        obj.setCoords();
        canvas.renderAll();

        obj.lockScalingX = true;
        obj.lockScalingY = true;
        obj.lockMovementX = true;
        obj.lockMovementY = true;
      }

      // restrict scaling over left of canvas
      if(left < 0) {
        obj.scaleX = 1;
        obj.setCoords();
        let w = obj.getScaledWidth();
        obj.scaleX = (width + left) / w;
        obj.left = 0;
        obj.setCoords();
        canvas.renderAll();
        obj.lockScalingX = true;
        obj.lockScalingY = true;
        obj.lockMovementX = true;
        obj.lockMovementY = true;
      }
    });

// function work when object move
canvas.on('object:moving', function(e) {
    var obj = e.target;

    if(obj.height > CANVAS_HEIGHT || obj.width > CANVAS_WIDTH){
        return;
    }       
    obj.setCoords();   
    if(obj.getBoundingRect().top < 0 || obj.getBoundingRect().left < 0){
        obj.top = Math.max(obj.top, obj.top-obj.getBoundingRect().top);
        obj.left = Math.max(obj.left, obj.left-obj.getBoundingRect().left);
    }
    if(obj.getBoundingRect().top+obj.getBoundingRect().height  > CANVAS_HEIGHT || obj.getBoundingRect().left+obj.getBoundingRect().width  > CANVAS_WIDTH){
        obj.top = Math.min(obj.top, CANVAS_HEIGHT-obj.getBoundingRect().height+obj.top-obj.getBoundingRect().top);
        obj.left = Math.min(obj.left, CANVAS_WIDTH-obj.getBoundingRect().width+obj.left-obj.getBoundingRect().left);
    }

});

 canvas.on('object:modified', function (event) {
      // after text object is done with modifing e.g. resizing or moving

      if (!!event.target) {
        event.target.lockScalingX = false;
        event.target.lockScalingY = false;
        event.target.lockMovementX = false;
        event.target.lockMovementY = false;
      }
 })
</script>
